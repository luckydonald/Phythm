<html>
<head>
<title> May Contain Ponys.</title>
<style>
#controls span 
{
	background-color: yellow;
}
.progressbar-outer{
	width:300px;
	padding:2px;
	background-color:white;
	border:1px solid black;
	text-align:center
}
.progressbar-inner{
	width:0px;
	background-color:green;	
}

</style>
</head>
<body>
<h1>Test</h1>





<script type="text/javascript">

function ajaxRequest(){
 var activexmodes=["Msxml2.XMLHTTP", "Microsoft.XMLHTTP"] //activeX versions to check for in IE
 if (window.ActiveXObject){ //Test for support for ActiveXObject in IE first (as XMLHttpRequest in IE7 is broken)
  for (var i=0; i<activexmodes.length; i++){
   try{
    return new ActiveXObject(activexmodes[i])
   }
   catch(e){
    //suppress error
   }
  }
 }
 else if (window.XMLHttpRequest) // if Mozilla, Safari etc
  return new XMLHttpRequest()
 else
  return false
}

var mygetrequest=new ajaxRequest()
mygetrequest.onreadystatechange=function(){
 if (mygetrequest.readyState==4){
  if (mygetrequest.status==200 ){ //|| window.location.href.indexOf("http")==-1
 //var jsondata=eval("("+mygetrequest.responseText+")") //retrieve result as an JavaScript object
   var jsondata = JSON.parse(mygetrequest.responseText);
   applyInfos(jsondata);

  }
  else{
   alert("An error has occured making the request")
  }
 }
}
var globalDataArray;
//mygetrequest.open("GET", "/cmd.json?info", true)	
//mygetrequest.send(null)
function $(id){
	return document.getElementById(id);
}
var refreshTimeout;

function ajaxAction(action){
	mygetrequest.open("GET", "/cmd.json?"+action, true);
	mygetrequest.send(null);
	dataArray = mygetrequest.dataArray;
		
	//refreshTimeout=window.Timeout(ajaxRefresh, 1000);
}
function applyInfos(dataArray){
	var infostring = dataArray.message.song.name + " by " + dataArray.message.song.artist;
	document.title = infostring;
	$("songtitle").innerHTML=dataArray.message.song.title;
	$("songalbum").innerHTML=dataArray.message.song.album;	
	$("songartist").innerHTML=dataArray.message.song.artist;	
	$("songbpm").innerHTML=dataArray.message.song.bpm + " BPM";
	var max = dataArray.message.song.totalsec;
	var max_date = new Date(max*1000);
	var curr = dataArray.message.song.currentsec;
	var curr_date = new Date(curr*1000);
	var progress = Math.round((100/max)*curr);	
	//alert("( 100 / "+ max + " ) * " + curr + " = " + progress);
	var curr_string= curr_date.getMinutes() +":"+curr_date.getSeconds()
	var x = document.getElementById("songprogress");
	x.style.width=progress*2;
	x.innerHTML=curr_string;
}



</script>
<div id="infobox">
	<div id="songinfo">
		<span id="songtitle">Unknown Title</span> - <span id="songalbum">Unknown Album</span> - <span id="songartist">Unknown Artist</span> @ <span id="songbpm">0 BPM</span>		
	</div>
	<div id="songinfo2">
		<div class="progressbar-outer">
			<div class="progressbar-inner" id="songprogress">--:--</div>
		</div>
	</div>
	<div id="controls">
		<input id="prev" type="button" value="&#9665;" onclick='ajaxAction("playlast")'/>
		<input id="playpause" type="button" value="&#65517;&nbsp;&#9658;" onclick='ajaxAction("playpause")'/>
		<input id="next" type="button" onclick='ajaxAction("playnext")' value="&#9655;" />
	</div>
<input type="button" onclick='ajaxAction("info")' value="&reg;"/>
<input type="button" onclick='ajaxAction("forcenext")' value="Force Next"/>

<hr>
The Pinkie Pie Is A Lie! 
</body>
</html>
